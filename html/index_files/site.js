/* Copyright Amazon.com 2010 */
function limitedText(){if(this.value.length>this.limit){this.value=this.value.substring(0,this.limit)}document.getElementById(this.callbackId).value=(this.limit-this.value.length)}$(document).ajaxSend(function(c,b,a){if(typeof(AUTH_TOKEN)=="undefined"){return}if(a.type=="GET"){return}if(/authenticity_token=/.test(a.data)){return}a.data=((a.data)?a.data+"&":"")+"authenticity_token="+encodeURIComponent(AUTH_TOKEN)});var showK4pcPopup=true;var timeWidgetImages=[];var defaultPopoverOptions={loadingContent:"<div class='popoverLoading'><img src='https://images-na.ssl-images-amazon.com/images/G/01/javascripts/lib/popover/images/snake._V265110081_.gif' /></div>"};var RefreshFetcher=new function(){var g={};var h=false;var d=1;var c=function(l,k,i){var j="/refresh/flashcard_highlights/"+l;$.ajax({type:"get",url:j,dataType:"json",beforeSend:function(m){m.setRequestHeader("Accept","application/javascript")},success:function(n){var m;for(m in n){g[m]=n[m]}k()},error:function(m,o,n){if(i){i(m,o,n)}}})};var f=function(i){if(i){$("#reviewContent").removeClass("reviewContentPopular")}else{$("#reviewContent").addClass("reviewContentPopular")}};var b=function(l,m,j){$("#loadingSpinnerPersonal").addClass("hidden");$("#loadingSpinnerPopular").addClass("hidden");$("#reviewContentHidden").html(l);if($("#reviewContentHidden").find(".noReview").size()>0){$(".reviewContentWrapper").html($("#reviewContentHidden").html());$("#reviewNavigation").find(".cardNumber").html("&nbsp;");$("#reviewNavigation").find(".reviewPrevious").html("&nbsp;");$("#reviewNavigation").find(".reviewNext").html("&nbsp;")}else{$("#reviewNavigation").find(".cardNumber").html($("#newNav").find(".cardNumber").html());$("#reviewNavigation").find(".reviewPrevious").html($("#newNav").find(".reviewPrevious").html());$("#reviewNavigation").find(".reviewNext").html($("#newNav").find(".reviewNext").html());var i=$("#reviewContentHidden").find(".cardType").html();f(i==="personal");$(".reviewHighlightArea").html($("#reviewContentHidden").find(".reviewHighlightArea").html());if($("#reviewContentHidden").find(".bookAsin").html()!==$("#reviewContent").find(".bookAsin").html()){$(".reviewBookInfoArea").html($("#reviewContentHidden").find(".reviewBookInfoArea").html())}if(m){$("#reviewContent").find(".highlightReplace").html(j.text);var k=$("#reviewContent").find(".readMore");k.text(k.text()+j.display_start);k.attr("href",k.attr("href")+j.display_start)}$(".reviewHighlightArea").removeClass("hidden");$(".reviewBookInfoArea").removeClass("hidden")}};var a=function(i,k,j){if(i.status!==0){$("#loadingReview").addClass("hidden");$("#refreshError").removeClass("hidden")}};this.displayLoading=function(i){if($("#reviewContent").hasClass("reviewContentPopular")){$("#loadingSpinnerPersonal").addClass("hidden");$("#loadingSpinnerPopular").removeClass("hidden")}else{$("#loadingSpinnerPersonal").removeClass("hidden");$("#loadingSpinnerPopular").addClass("hidden")}$(".noReview").addClass("hidden");$(".reviewHighlightArea").addClass("hidden");if(i){$(".reviewBookInfoArea").addClass("hidden")}};this.loadByHash=function(m){var k=false;var l;var n;var i;if(m.length<1){l=window.location.href.split("/");i=l[l.length-1];n=l[l.length-2];m=n+"_"+i}var j=null;if(m==="no_more"){j="/refresh/nothing_to_add"}else{l=m.split("_");if(l.length>2&&l[2]==="more"){k=true}n=l[0];i=parseInt(l[1],10);j="/refresh/"+n+"/"+i+"/"+(new Date().getTime())}if(n==="f"){d=i}e(j,n==="f",i,k)};this.loadByURL=function(i){e(i,false)};var e=function(k,j,i,l){RefreshFetcher.displayLoading(false);if(j&&((!isNaN(i)&&!g[i])||(l&&g[i].text===undefined))){c(i,function(){e(k,j,i,l)},a)}else{$.ajax({type:"get",url:k,beforeSend:function(m){m.setRequestHeader("Accept","application/javascript")},success:function(m){b(m,j,g[i])},error:function(m,o,n){a(m,o,n)}})}}};function readyFunction(){var i=$.browser.msie&&$.browser.version<7;var f=i?"classic":"default";var n=function(w,v,x){if(w!==null){var u=$(w).parents("form")[0];if(u){v=u.action;x=w.title}else{if(w.href&&w.title){v=w.href;x=w.title}}}return $.extend({},defaultPopoverOptions,{ajaxSlideDuration:0,modal:true,showOnHover:false,destination:v+"&popover=1",windowMargin:10,width:700,closeEventInclude:"CLICK_OUTSIDE",cacheable:false,title:x,skin:i?"classic":"default",paddingLeft:0,paddingRight:0,paddingBottom:0})};$(".shoveler:not(.suppressed)").livequery(function(){var u=$(this).find("li").size();$(this).shoveler(function(v,w){},u,{nextButtonSelector:"a.next-button",prevButtonSelector:"a.prev-button"})});if($("#reviewContent").size()>0){if($("#reviewContent").hasClass("reviewFirstCard")){var t=$("#reviewContent").find("[name=reviewPosition]").attr("value");RefreshFetcher.loadByHash("f_"+t)}else{$.history.init(RefreshFetcher.loadByHash)}}$("a.reviewContent").livequery("click",function(){var w=this.href.split("/");var u=w[w.length-1];var x=w[w.length-2];var v=x+"_"+u;$.history.load(v);return false});$("a.reviewContentMore").livequery("click",function(){RefreshFetcher.displayLoading(true);$.ajax({type:"get",dataType:"json",url:this.href,beforeSend:function(u){u.setRequestHeader("Accept","application/javascript")},success:function(u){if(u.newUrlToLoad!=null){window.location=u.newUrlToLoad}else{var v="";if(u.firstAddedCard){v="f_"+u.firstAddedCard+"_more"}else{v="no_more"}$(".reviewBookInfoArea").addClass("hidden");$.history.load(v)}},error:function(u,w,v){displayError(u,w,v)}});return false});$("a.popWindow").livequery("click",function(){window.open(this.href,this.rel,"height=600,width=500,left=10,top=10,resizable=yes,scrollbars=yes,toolbar=no,menubar=no,location=no,directories=no,status=yes");return false});$("#ciUploadForm").livequery("submit",function(){$(".error").hide();var u=true;if(!$("input[name=file_1]").val()){$("#noFile").show();u=false}if(!$("input[name=terms]").is(":checked")){$("#noTC").show();u=false}return u});$("form.rjsProfileEdit").livequery(function(){var u=$(this);u.ajaxForm({dataType:"json",beforeSend:function(v){u.find(".error").hide();v.setRequestHeader("Accept","text/javascript");u.find(".successText").hide();u.find(".messageText").show();u.find("input, textarea").attr("disabled","disabled")},success:function(w){u.find(".messageText").hide();u.find("input, textarea").attr("disabled",null);if(w.errors){for(var y in w.errors){u.find("#"+y).siblings(".customError").html(w.errors[y]).show()}}else{if(w.updated){for(var x in w.updated){u.find("input[name="+x+"]")[0].value=w.updated[x]}}var v=u.parents(".profilePreferences");v.find(".needName").hide();v.find(".uploadLink").show();u.find(".successText").show()}},error:function(v,x,w){u.find(".messageText").hide();u.find("input, textarea").attr("disabled",null);u.find(".error").show()},resetForm:false})});$("a.deleteConfirm").livequery(function(){var v=$(this).parents(".deletable");var u=$.extend({},defaultPopoverOptions,{ajaxSlideDuration:0,modal:true,showOnHover:false,destination:this.href,windowMargin:5,width:350,closeEventInclude:"CLICK_OUTSIDE",cacheable:false,skin:f,location:function(z,x){var A={left:v.offset().left+v.width()-z.outerWidth()+20,top:v.offset().top+15};var w=A.top+z.outerHeight();var y=$(window).scrollTop()+$(window).height();var B=w-y;if(B>0){window.scrollBy(0,B)}return A},onShow:function(w){v.addClass("active")},onHide:function(w){v.removeClass("active")}});if(this.href.indexOf("is_post")!=-1){u.width=600}$(this).amazonPopoverTrigger(u)});$("form.rjsDeleteEvent").livequery(function(){var u=$(this);u.ajaxForm({dataType:"json",beforeSend:function(v){u.find(".error").hide();v.setRequestHeader("Accept","text/javascript")},success:function(v){u.find(".ap_custom_close").click();$("#event"+v.id).remove()},error:function(v,x,w){u.find(".ap_custom_close").click()},resetForm:false})});function o(w,u){w=w.get(0);if(w.setSelectionRange){w.setSelectionRange(u,u)}else{if(w.createTextRange){var v=w.createTextRange();v.collapse(true);v.moveEnd("character",u);v.moveStart("character",u);v.select()}}}function r(u){var v=$(u).parent().find(".saveButton");v.removeClass("saveButtonInactive");v.attr("disabled",false)}function a(v){var u=v.find(".editNote");if(u.length==0){u=v.find(".shareForm")}var y=$("#"+u.find("[name=note_area_id]").val());u.find("[name=asin]").val(y.find(".asin").text());u.find("[name=annotation_id]").val(y.find(".annotation_id").text());u.find("[name=end_location]").val(y.find(".end_location").text());u.find("[name=note_text]").val(y.find(".noteContent").text());u.find("[name=message]").val(y.find(".noteContent").text());var x=v.find(".noteArea");if(x.length==0){x=v.find(".shareArea")}if(x.length>0){var w=x.val();x.bind("keyup",function(){if(x.val()!=w){x.unbind();r(x)}});x.focus();o(x,x.val().length)}}$("a.addEditNote").livequery(function(){$(this).amazonPopoverTrigger({ajaxSlideDuration:0,showOnHover:false,destination:this.href+"&popover=1",closeEventInclude:"CLICK_OUTSIDE",hoverShowDelay:200,width:$(this).parent().width(),location:function(x,v){var y=$(this).parents(".editNote");var z={left:y.offset().left-15,top:y.offset().top-5};var u=z.top+x.outerHeight();var w=$(window).scrollTop()+$(window).height();var A=u-w;if(A>0){window.scrollBy(0,A)}return z},cacheable:true,title:null,skin:f,onFilled:a})});$("a.shareNote").livequery(function(){$(this).amazonPopoverTrigger({ajaxSlideDuration:0,showOnHover:false,destination:this.href+"&popover=1",closeEventInclude:"CLICK_OUTSIDE",hoverShowDelay:200,width:420,location:function(x,v){var y=$(this).parents(".editNote");var z={left:y.offset().left-15,top:y.offset().top-5};var u=z.top+x.outerHeight();var w=$(window).scrollTop()+$(window).height();var A=u-w;if(A>0){window.scrollBy(0,A)}return z},cacheable:true,title:"Share Highlight & Note",skin:f,onFilled:a})});$("a.showPublishers").livequery(function(){$(this).amazonPopoverTrigger($.extend({},defaultPopoverOptions,{ajaxSlideDuration:0,modal:true,showOnHover:false,destination:this.href+"&popover=1",windowMargin:10,width:700,closeEventInclude:"CLICK_OUTSIDE",cacheable:false,title:"Customers with Public Notes for this Book",skin:f,paddingLeft:0,paddingRight:0,paddingBottom:0}))});$("a.showFriends").livequery(function(){$(this).amazonPopoverTrigger(n(this))});$("button.linkButtonPopup").livequery(function(){$(this).amazonPopoverTrigger(n(this))});$("form.networkSettingsConfirm").livequery(function(){var u=$(this);u.ajaxForm({beforeSend:function(v){v.setRequestHeader("Accept","text/javascript")},success:function(w){var v=u.parents(".linkPopup");v.html(w)},error:function(v,x,w){},resetForm:false})});$("form.setPubSub").livequery(function(){var u=$(this);u.ajaxForm({dataType:"json",beforeSend:function(v){v.setRequestHeader("Accept","text/javascript")},success:function(w){if(!w.error){if(w.active==true){u.find(".pubsubStart").addClass("hidden");u.find(".pubsubStop").removeClass("hidden");u.find(".pubsubAction").attr("value","stop");if(w.make_public==true){var v=$("#editionRelationWidget"+w.asin);v.find(".privacy input").eq(0).attr("class","publicActive");v.find(".privacy input").eq(1).attr("class","private");v.find(".privacy .text").html("Public");v.editionRelationWidget()}}else{u.find(".pubsubStart").removeClass("hidden");u.find(".pubsubStop").addClass("hidden");u.find(".pubsubAction").attr("value","start")}if(w.stats){$("#numFollowing"+w.stats[0].cid).html(w.stats[0].num_following.toString());$("#numFollowers"+w.stats[0].cid).html(w.stats[0].num_followers.toString());$("#numFollowers"+w.stats[1].cid).html(w.stats[1].num_followers.toString())}if(w.pubsub_html){$("#pubsub").html(w.pubsub_html)}}},error:function(v,x,w){},resetForm:false})});$("a.previewLink").livequery(function(){$(this).expandCollapseBelow({expandClass:"expand",expandHtml:'<span class="innerText">Preview</span>',collapseClass:"collapse",collapseHtml:'<span class="innerText">Close Preview</span>',targetId:this.rel,remote:true})});$("a.expandCollapsePublisher").livequery(function(){$(this).expandCollapseBelow({targetId:this.rel,remote:true})});$("a.expandCollapsePublisherEmpty").livequery(function(){$(this).expandCollapseBelow({targetId:this.rel})});$("a.rhtmlInHidden").livequery("click",function(){var u=this.href;var v="#"+this.rel;$.ajax({type:"get",url:u,dataType:"html",beforeSend:function(w){w.setRequestHeader("Accept","application/javascript");$(".toHide").addClass("hidden");$(v).removeClass("hidden")},success:function(w){$(v).html(w)},error:function(w,y,x){$(v).html("Sorry, something went wrong...")}});return false});$("a.seeMore").livequery("click",function(){$(this).blur();var w=$(this);var u=this.href;var v="#"+this.rel;var x=$("#loadingImage");$.ajax({type:"get",url:u,dataType:"json",beforeSend:function(y){y.setRequestHeader("Accept","application/javascript");x.show()},success:function(y){x.hide();newspan=$("<span/>");newspan.html(y.new_html);newspan.hide();$(v).append(newspan);if(!y.show_more){w.hide()}else{w.attr("href",y.new_link_url)}newspan.show()},error:function(y,A,z){}});return false});if($().tour){$("a.tourLink").tour("/home/tour",700)}$(".authorResponse").livequery(function(){$(this).authorResponse()});$("a.share").livequery(function(){$(this).amazonPopoverTrigger({ajaxSlideDuration:0,showOnHover:false,destination:this.href+"&popover=1",closeEventInclude:"CLICK_OUTSIDE",hoverShowDelay:200,width:420,cacheable:true,title:this.title,paddingLeft:8,paddingRight:8,paddingBottom:5,location:function(w,v){var u=this;return{left:this.offset().left-100,top:this.offset().top-20}}})});$("div.tabs").livequery(function(){$(this).tabbedContent()});$("div.countdownText").livequery(function(){$(this).countdownText()});var s=function(u){if(u.made_public){$("input[name=publicKindleWeightUncheck]").hide();$("input[name=publicKindleWeightCheck]").show();$("#publicKindleWeightLabel").attr("for","publicKindleWeightCheck")}};$("form.weightShareForm").livequery(function(){$(this).share({successFunction:s})});var l=function(u){if(u.lent_asin){if(u.redemption_url){$(".loanCreatedLink."+u.lent_asin).attr("href",u.redemption_url)}$(".loanCreated."+u.lent_asin).show();if(u.hide_share_buttons){$(".broadcastLendingLinks."+u.lent_asin).hide();$(".directLoanCreation."+u.lent_asin).hide()}}};$("form.loanShareForm").livequery(function(){$(this).share({successFunction:l})});$("form.noteShareForm").livequery(function(){$(this).share({successFunction:function(u){d(u.note_area_id,u.new_text);m(u)}})});$(".editionRelationWidget").livequery(function(){$(this).editionRelationWidget()});$(".readingStatusWidget").livequery(function(){$(this).bookStateWidget();$(this).readingStatusWidget()});$(".publicBookWidget").livequery(function(){$(this).bookStateWidget();$(this).publicBookWidget()});$(".publicNotesWidget").livequery(function(){$(this).bookStateWidget();$(this).publicNotesWidget()});$(".dropBookWidget").livequery(function(){$(this).bookStateWidget();$(this).dropBookWidget()});$("a.whatsThis").livequery(function(){var u=$.extend({},defaultPopoverOptions,{showOnHover:true,destination:this.href,closeEventInclude:"MOUSE_LEAVE",hoverShowDelay:200,title:this.title,skin:f});if($(this).hasClass("bottomTopPopover")){u.location=["bottom","top","auto"]}$(this).amazonPopoverTrigger(u)});$(".reliableTooltip").livequery(function(){$(this).reliableTooltip()});$(".kindleReaderSampleButton").webReaderLauncher();$("a.k4pcReadMore").livequery(function(){var u=navigator.userAgent.toLowerCase();if((u.indexOf("windows")!=-1||u.indexOf("macintosh")!=-1)&&u.indexOf("opera")==-1&&u.indexOf("netfront")==-1&&u.indexOf("windows ce")==-1&&u.indexOf("windows phone")==-1){$(this).show()}});var g=function(u){var v=$("#kframe");if(v.size()==0){v=$('<iframe id="kframe"></iframe>');$("body").append(v);v.hide()}v.attr("src",u)};var k=function(){g(this.href);if(showK4pcPopup){var v="Opening in Kindle for PC...";if(navigator.userAgent.toLowerCase().indexOf("macintosh")!=-1){v="Opening in Kindle for Mac..."}var u=$("<a></a>");u.amazonPopoverTrigger($.extend({},defaultPopoverOptions,{showOnHover:false,modal:true,destination:"/work/kindle_for_pc_firefox",closeEventInclude:"CLICK_OUTSIDE",location:"centered",width:430,paddingLeft:10,paddingRight:10,paddingBottom:1,windowMargin:0,cacheable:true,skin:f,title:v,onFilled:function(w){u.fadeTo(30000,1,function(){w.find("#k4pcPopupClose").click()})}}));u.click()}return false};var b=function(){k4pcBookHref=this.href;if(showK4pcPopup){var u=$("<a></a>");u.amazonPopoverTrigger($.extend({},defaultPopoverOptions,{showOnHover:false,modal:true,destination:"/work/kindle_for_pc_ie",closeEventInclude:"CLICK_OUTSIDE",location:"centered",width:430,paddingLeft:10,paddingRight:10,paddingBottom:1,windowMargin:0,cacheable:true,skin:f}));u.click()}else{g(k4pcBookHref)}return false};if(navigator.userAgent.toLowerCase().indexOf("msie")!=-1){$("a.k4pcReadMore").livequery("click",b);$("form#k4pcDoNotShow").livequery("click",function(){g(k4pcBookHref)})}else{$("a.k4pcReadMore").livequery("click",k)}$("form#k4pcDoNotShow").livequery(function(){$(this).ajaxForm({type:"post",beforeSubmit:function(){showK4pcPopup=false;$("#k4pcPopupClose").click()}})});$("button.k4pcAppDownload").livequery("click",function(){window.open(this.name);$("#k4pcPopupClose").click()});$(".prioritySelectionForm").livequery(function(){$(this).ajaxForm({type:"post",beforeSend:function(u){u.setRequestHeader("Accept","text/javascript")}})});$(".prioritySelectionForm select").livequery("change",function(){$(this).parent().submit()});$("a.rjs").livequery("click",function(){$.ajax({url:this.href,dataType:"script",beforeSend:function(u){u.setRequestHeader("Accept","text/javascript")}});return false});$(".textAreaLimited").livequery(function(){this.limit=parseInt($(this).next().text(),10);this.callbackId=$(this).next().next().text();$(this).keydown(limitedText);$(this).keyup(limitedText);$(this).blur(limitedText)});$("form.rhtml").livequery(function(){var u=this;$(this).ajaxForm({type:"post",beforeSend:function(v){v.setRequestHeader("Accept","text/javascript")},success:function(v){$("#"+u.title).html(v)},resetForm:true})});$("select.yourBooksDisplaySelect").livequery("change",function(){location.href=this.value});$("form.rjs").livequery(function(){$(this).ajaxForm({dataType:"script",beforeSend:function(u){u.setRequestHeader("Accept","text/javascript")},resetForm:true})});$(".deleteHighlightForm").livequery(function(){$(this).ajaxForm({beforeSend:function(u){u.setRequestHeader("Accept","text/javascript")}})});$(".deleteHighlightForm button").livequery("click",function(){$(this).parent().hide();var u=$(this).parents(".highlightRow");if(u.size()==0){u=$(this).parents(".singleHighlight")}var v=0;if($(this).attr("name")=="undo"){$(this).parents(".whatIsThis").children(".thisIsPersonal").removeClass("context");$(this).parent().parent().find(".deleteHighlight").show();u.find(".removableQuote").show();u.find(".context").removeClass("context").addClass("highlight");v=1}else{$(this).parents(".whatIsThis").children(".thisIsPersonal").addClass("context");$(this).parent().parent().find(".deleteHighlightUndo").show();u.find(".removableQuote").hide();u.find(".highlight").removeClass("highlight").addClass("context");u.find(".overlappingPopularHighlight").removeClass("overlappingPopularHighlight").addClass("context");v=-1}var w=$(this).parent().parent().find("[name=asin]").attr("value");p(0,v,w);return true});$("a.feedback").livequery(function(){$(this).amazonPopoverTrigger($.extend({},defaultPopoverOptions,{width:530,showOnHover:true,destination:this.href,closeEventInclude:"CLICK_OUTSIDE",closeEventExclude:"MOUSE_LEAVE",hoverShowDelay:2000,title:this.title,skin:f,location:function(w,v){var u=$(".userNav");return{left:u.offset().left+u.outerWidth()-w.outerWidth(),top:u.offset().top}}}))});function c(w,u){var v=$(w).parent().parent().parent().parent().find(".submitFeedbackButton");if(u){v.removeClass("submitFeedbackButtonInactive")}else{v.addClass("submitFeedbackButtonInactive")}v.attr("disabled",!u)}$(".feedbackArea").livequery(function(){$(this).keyup(function(){if($(this).val().length>0){c(this,true)}else{c(this,false)}})});$("form.rjsFeedbackPopup").livequery(function(){var u=$(this);u.ajaxForm({beforeSend:function(v){v.setRequestHeader("Accept","text/javascript")},success:function(v){$("#feedbackNote").html(v);$("#feedbackNote").find("#feedbackCloseLink").click(function(){$("#feedbackNote").parent().find(".ap_custom_close").click()});window.setTimeout(function(){$("#feedbackNote").parent().find(".ap_custom_close").click()},2000)},resetForm:false})});function j(v,w){var D=$("#seeBookViewLink");var u=0;if($(".linkNoteCount").size()>0){u=parseInt($(".linkNoteCount").text())}var E=u+v;var B=0;if($(".linkHighlightCount").size()>0){B=parseInt($(".linkHighlightCount").text())}var C=B+w;if(u!=E||B!=C){D.empty();D.append(document.createTextNode("See all "));if(C>0){var A=document.createElement("span");$(A).addClass("linkHighlightCount");var x=" highlights ";if(C==1){x=" highlight "}$(A).append(document.createTextNode(C));D.append(A);D.append(document.createTextNode(x))}if(C>0&&E>0){D.append(document.createTextNode("and "))}if(E>0){var z=document.createElement("span");$(z).addClass("linkNoteCount");var y=" notes ";if(E==1){y=" note "}$(z).append(document.createTextNode(E));D.append(z);D.append(document.createTextNode(y))}D.append(document.createTextNode("from this book"));if(E==0&&C==0){D.hide()}else{D.show()}}}function p(v,w,z){var y=$(".highlightCount"+z);var B=parseInt(y.text());var C=B+w;y.text(C);var x=y.parent();var u=y.parent().html();if(B!=C&&C==1){x.html(u.substring(0,u.length-1))}else{if(B!=C&&B==1){x.html(u+"s")}}var A=$(".noteCount"+z);var B=parseInt(A.text());var C=B+v;A.text(C);var x=A.parent();var u=x.html();if(B!=C&&C==1){x.html(u.substring(0,u.length-1))}else{if(B!=C&&B==1){x.html(u+"s")}}if($("#seeBookViewLink").size()>0){j(v,w)}}$("form.makePersonalForm").livequery(function(){var u=$(this);u.ajaxForm({dataType:"json",beforeSend:function(w){var v=u.parents(".highlightRow");if(v.hasClass("popularHighlight")){v.removeClass("popularHighlight").addClass("personalHighlight");v.find(".context").hide();v.find(".highlight").removeClass("highlight").addClass("overlappingPopularHighlight");v.find(".location").hide();v.find(".quote").hide();v.find(".removableQuote").show();v.find(".makePersonalForm").hide();v.find(".popularHighlightNote").text("attached");v.find(".locationOverlap").show()}w.setRequestHeader("Accept","text/javascript")},success:function(w){if(w.highlight_id!=null){var v=u.parents(".highlightRow");v.find(".readMorePhl").html(w.read_more);v.find(".editNotePhl").html(w.add_note);v.find(".deleteHighlightPhl").html(w.delete_highlight)}p(0,w.highlight_count_adjustment,w.asin)},resetForm:false})});function p(v,w,z){var y=$(".highlightCount"+z);var B=parseInt(y.text());var C=B+w;y.text(C);var x=y.parent();var u=y.parent().html();if(B!=C&&C==1){x.html(u.substring(0,u.length-1))}else{if(B!=C&&B==1){x.html(u+"s")}}var A=$(".noteCount"+z);var B=parseInt(A.text());var C=B+v;A.text(C);var x=A.parent();var u=x.html();if(B!=C&&C==1){x.html(u.substring(0,u.length-1))}else{if(B!=C&&B==1){x.html(u+"s")}}if($("#seeBookViewLink").size()>0){j(v,w)}}var m=function(w){var y=w.note_area_id;noteArea=$("#"+y);editLink=noteArea.find(".addEditNote");var v=w.annotation_id;noteArea.find(".annotation_id").text(v);p(w.note_count_adjustment,0,w.asin);if(w.note_count_adjustment<0){var u=noteArea.parent().find(".editNote").size();if(u>1){noteArea.remove()}else{var x=noteArea.parents(".noteOnly");if(x){x.remove()}}}};var d=function(w,u){var v=$("#"+w);v.find(".noteContent").text(u);if(u.length>0){v.find(".addEditNote").text("Edit");v.find(".yourNote").removeClass("hidden")}else{v.find(".addEditNote").text("Add a Note");if(!v.hasClass("flashcardNote")){v.find(".yourNote").addClass("hidden")}}};$("form.rjsNoteEdit").livequery(function(){var u=$(this);u.ajaxForm({dataType:"json",beforeSend:function(v){u.find(".editNoteCloseButton").click();d(u.find("[name=note_area_id]").val(),u.find("[name=note_text]").attr("value"));v.setRequestHeader("Accept","text/javascript")},success:function(v){m(v)},resetForm:false})});$("a.rhtml").livequery("click",function(){var v="#"+this.rel;var u=this.href;$.ajax({type:"get",url:u,beforeSend:function(w){w.setRequestHeader("Accept","application/javascript")},success:function(w){$(v).html(w)}});return false});$(".noFocus").livequery("click",function(){$(this).blur()});$(".selectSubmit").livequery("change",function(u){location.href=u.target.options[u.target.selectedIndex].value});$(".radioSubmit").livequery("change",function(u){location.href=u.target.value});$("button.textSubmit").livequery(function(){$(this).hover(function(){$(this).addClass("textSubmitHover")},function(){$(this).removeClass("textSubmitHover")})});$("a.expand, a.collapse").livequery(function(){$(this).hover(function(){$(this).find(".innerText").addClass("innerTextHover")},function(){$(this).find(".innerText").removeClass("innerTextHover")})});$("#seeMoreForm").livequery(function(){var u=this;$(this).ajaxForm({type:"post",beforeSend:function(v){v.setRequestHeader("Accept","text/javascript")},success:function(v){$(".seeMoreLink").remove();$(".seeMoreLoading").remove();var w=$(".seeMoreItem").size()-1;$(".seeMoreItem:last").after(v)},resetForm:true})});$("#seeMoreForm a").livequery("click",function(){$(".seeMoreLink").hide();$(".seeMoreLoading").show();$("#seeMoreForm").submit();return false});$(".userRatingWidget").livequery(function(){$(this).starRating()});$("form.dismissNag").livequery(function(){var u=$(this);u.ajaxForm({type:"post",dataType:"json",beforeSend:function(v){v.setRequestHeader("Accept","text/javascript")},success:function(v){u.parents(".nag").hide()},error:function(v,x,w){}})});if(document.location.hash=="#findFriendsTwitter"){var e=n(null,"/home/friends?type=twitter&just_returned=1","People You Follow on Twitter");var h=$.AmazonPopover.displayPopover(e)}else{if(document.location.hash=="#findFriendsFacebook"){var e=n(null,"/home/friends?type=facebook&just_returned=1","People You Know on Facebook");var h=$.AmazonPopover.displayPopover(e)}else{if(document.location.hash=="#findFriendsLinkedIn"){var e=n(null,"home/friends?type=linkedin&just_returned=1","Your Connections on LinkedIn");var h=$.AmazonPopover.displayPopover(e)}else{if(document.location.hash=="#shareFacebook"){$(".shareFacebook").click()}else{if(document.location.hash=="#shareTwitter"){$(".shareTwitter").click()}else{if(document.location.hash.indexOf("#loanFacebook")==0){$(".shareFacebook."+document.location.hash.substring(14)).click()}else{if(document.location.hash.indexOf("#loanTwitter")==0){$(".shareTwitter."+document.location.hash.substring(13)).show();$(".shareTwitter."+document.location.hash.substring(13)).click()}else{if(document.location.hash.indexOf("#share")==0){var q=document.location.hash.substring(6);$("#"+q).find(".shareNote").click()}}}}}}}}}$(document).ready(readyFunction);
/* Copyright Amazon.com 2011 */
$.fn.bookStateWidget=function(){return this.each(function(){var a=this;$.extend(this,{asin:$("input[name=asin]",a).attr("value"),url:$("form",a).attr("action"),publicNotesWidget:null,publicBookWidget:null,bookStatusWidget:null,dropBookWidget:null,findRelatedWidgets:function(){a.publicNotesWidget=$("#publicNotesWidget"+a.asin)[0];a.publicBookWidget=$("#publicBookWidget"+a.asin)[0];a.bookStatusWidget=$("#readingStatusWidget"+a.asin)[0];a.dropBookWidget=$("#dropBookWidget"+a.asin)[0]}});this.findRelatedWidgets()})};
/* Copyright Amazon.com 2010 */
$.fn.editionRelationWidget=function(){function a(c){if(!$(c).attr("class").match(/Active\b/)){$(c).attr("class",$(c).attr("class").replace(c.name,c.name+"Active"))}}function b(c){$(c).attr("class",$(c).attr("class").replace(c.name+"Active",c.name))}return this.each(function(){var c=this;$.extend(this,{activeStatus:null,activePrivacy:null,statusHasChanged:false,privacyHasChanged:false,saving:false,asin:$("input[name=asin]",c).attr("value"),url:$("form",c).attr("action"),fetchCounts:true,kindleOnly:$("input[name=kindle_only]",c).attr("value"),init:function(){c.setStateFromForm();$("input",c).removeAttr("disabled").hover(function(){$(".text",$(this).parent()).text(this.alt);a(this)},c.redraw).click(c.inputClick);c.redraw()},markReadIfUnknown:function(){if(c.activeStatus===null||c.activeStatus.name==="drop"){c.activeStatus=$("input[name=read]",c).get(0);c.redraw()}},setStateFromForm:function(){$(".status  input",c).each(function(){if($(this).attr("class").search(/Active\b/)!=-1){c.activeStatus=this}});$(".privacy input",c).each(function(){if($(this).attr("class").search(/Active\b/)!=-1){c.activePrivacy=this}})},inputClick:function(){var e=true;$(this).blur();if($(this).parent().hasClass("status")){c.activeStatus=this;c.statusHasChanged=true}else{fetchCounts=false;var d=c.activePrivacy.name;c.activePrivacy=this;e=c.activeStatus!==null&&c.activeStatus.name!=="drop"&&d!==c.activePrivacy.name;c.privacyHasChanged=true}if(e){c.submit()}c.redraw();return false},setActiveStatus:function(d){c.activeStatus=$(".status input[name="+d+"]",c).get(0)},setActivePrivacy:function(d){c.activePrivacy=$(".privacy input[name="+d+"]",c).get(0)},submit:function(){var d={fetch_counts:c.fetchCounts,asin:c.asin,kindle_only:c.kindleOnly};if(c.activePrivacy!==null){d.privacy=c.activePrivacy.name}else{d.privacy="undecided"}d[c.activeStatus.name]=true;if(!c.statusHasChanged&&c.privacyHasChanged){$(".privacy .text",c).hide();$(".status .text",c).show();$(".privacy .savingText",c).show()}else{$(".status .text",c).hide();$(".status .savingText",c).show();$(".privacy .text",c).show()}$(".errorText",c).hide();c.statusHasChanged=false;c.privacyHasChanged=false;$.ajax({type:"post",url:c.url,beforeSend:function(e){e.setRequestHeader("Accept","text/javascript")},dataType:"json",data:d,success:function(e){if(e.counts){for(i=1;i<=e.counts.length;i++){$("#readingListCount"+i).text(e.counts[i])}$("#readingListCountTotal").text(e.sum);$("#readingListCountUndecided").text(e.undecided)}$(".savingText",c).hide();$(".text",c).show();if(e.notes_dropped){c.changeNotePrivacy()}c.redraw()},error:function(e){$(".savingText:visible",c).hide().next(".errorText").show();c.redraw()}})},changeNotePrivacy:function(){var e=$("form.setPubSub");if(e.find(".pubsubAction").attr("value")==="stop"){e.find(".pubsubStart").removeClass("hidden");e.find(".pubsubStop").addClass("hidden");e.find(".pubsubAction").attr("value","start");var d=$("#subscriberLink .showPublishers");if(d.html()-1>1){d.html(d.html()-1)}else{if(d.html()-1==1){d.html(d.html()-1);$("#customerText").html("customer has")}else{d.parent().html("0");$("#customerText").html("customers have")}}}},redraw:function(){$("input",c).each(function(){b(this)});var e="&nbsp;";var d="&nbsp;";if(c.activeStatus!==null){e=c.activeStatus.alt;a(c.activeStatus);$("input[name=drop]",c).fadeIn();if(c.activeStatus.name==="drop"){$(".privacy",c).hide();c.setActivePrivacy("private")}else{if(c.activePrivacy!==null){d=c.activePrivacy.alt;a(c.activePrivacy)}$(".privacy",c).show()}}else{$(".privacy",c).hide()}$(".status .text",c).html(e);$(".privacy .text",c).html(d)}});this.init()})};
/* Copyright Amazon.com 2011 */
$.fn.readingStatusWidget=function(){function a(c){if(!$(c).attr("class").match(/Active\b/)){$(c).attr("class",$(c).attr("class").replace(c.name,c.name+"Active"))}}function b(c){$(c).attr("class",$(c).attr("class").replace(c.name+"Active",c.name))}return this.each(function(){var c=this;$.extend(this,{activeStatus:null,statusHasChanged:false,inputDisabled:false,kindleOnly:$("input[name=kindle_only]",c).attr("value"),init:function(){c.setStateFromForm();$("input",c).removeAttr("disabled").hover(function(){if(!c.inputDisabled){$(".text",$(this).parent()).text(this.alt);a(this)}},c.redraw).click(c.inputClick);c.redraw()},enable:function(){c.inputDisabled=false;c.redraw()},disable:function(){c.inputDisabled=true;c.redraw()},currentState:function(){return c.activeStatus.name},setStateFromForm:function(){$(".status  input",c).each(function(){if($(this).attr("class").search(/Active\b/)!=-1){c.activeStatus=this}})},inputClick:function(){if(!c.inputDisabled){$(this).blur();c.activeStatus=this;c.statusHasChanged=true;c.submit();c.redraw()}return false},submit:function(){var d={asin:c.asin,kindle_only:c.kindleOnly};d[c.activeStatus.name]=true;if(c.statusHasChanged){$(".status .text",c).hide();$(".status .savingText",c).show()}$(".errorText",c).hide();c.statusHasChanged=false;$.ajax({type:"post",url:c.url,beforeSend:function(e){e.setRequestHeader("Accept","text/javascript")},dataType:"json",data:d,success:function(e){if(e.counts){for(i=1;i<=e.counts.length;i++){$("#readingListCount"+i).text(e.counts[i])}$("#readingListCountTotal").text(e.sum);$("#readingListCountUndecided").text(e.undecided)}$(".savingText",c).hide();$(".text",c).show();c.redraw()},error:function(e){$(".savingText:visible",c).hide().next(".errorText").show();c.redraw()}})},redraw:function(){$("input",c).each(function(){b(this)});var d="&nbsp;";if(!c.inputDisabled&&c.activeStatus!==null){d=c.activeStatus.alt;a(c.activeStatus);$("input[name=drop]",c).fadeIn()}$(".status .text",c).html(d)}});this.init()})};
/* Copyright Amazon.com 2011 */
$.fn.publicNotesWidget=function(){return this.each(function(){var a=this;$.extend(this,{state:null,stateBeforeSave:null,stateBeforeDisable:null,init:function(){a.setStateFromForm();$("input",a).click(a.inputClick);a.redraw()},setStateFromForm:function(){$(".status  input",a).each(function(){if(!$(this).hasClass("hidden")){a.state=this}})},disable:function(b){a.stateBeforeDisable=a.state.name;if(b){a.setState(b)}else{if(a.state.name=="public"){a.setState("publicDisabled")}else{if(a.state.name=="private"){a.setState("privateDisabled")}}}a.redraw()},enable:function(){if(a.stateBeforeDisable){a.setState(a.stateBeforeDisable);a.stateBeforeDisable=null}else{if(a.state.name=="publicDisabled"){a.setState("public")}else{if(a.state.name=="privateDisabled"){a.setState("private")}}}a.redraw()},currentState:function(){if(a.state.name.search("public")!=-1){return"public"}else{return"private"}},inputClick:function(){$(this).blur();if(a.state.name.search(/Disabled\b/)==-1){a.stateBeforeSave=a.state.name;if(a.state.name=="public"){a.setState("private");a.publicBookWidget.enable()}else{if(a.state.name=="private"){a.setState("public");a.publicBookWidget.disable()}}a.redraw();a.submit()}return false},setState:function(b){a.state=$(".status input[name="+b+"]",a).get(0)},submit:function(){var c="stop";if(a.state.name=="public"){c="start"}var b={asin:a.asin,publish:c};$.ajax({type:"post",url:a.url,beforeSend:function(d){d.setRequestHeader("Accept","text/javascript")},dataType:"json",data:b,success:function(d){a.stateBeforeSave=null},error:function(d){a.setState(a.stateBeforeSave);a.redraw()}})},redraw:function(){$("input",a).each(function(){$(this).hide()});if(a.state!==null){$(a.state).show()}}});this.init()})};
/* Copyright Amazon.com 2011 */
$.fn.publicBookWidget=function(){return this.each(function(){var a=this;$.extend(this,{state:null,stateBeforeSave:null,stateBeforeDisable:null,init:function(){a.setStateFromForm();$("input",a).click(a.inputClick);a.redraw()},setStateFromForm:function(){$(".status  input",a).each(function(){if(!$(this).hasClass("hidden")){a.state=this}})},inputClick:function(){$(this).blur();if(a.state.name.search(/Disabled\b/)==-1){a.stateBeforeSave=a.state.name;if(a.state.name=="public"){a.setState("private");if(a.publicNotesWidget!==undefined){a.publicNotesWidget.disable()}}else{if(a.state.name=="private"){a.setState("public");if(a.publicNotesWidget!==undefined){a.publicNotesWidget.enable()}}}a.redraw();a.submit()}return false},disable:function(b){a.stateBeforeDisable=a.state.name;if(b){a.setState(b)}else{if(a.state.name=="public"){a.setState("publicDisabled")}else{if(a.state.name=="private"){a.setState("privateDisabled")}}}a.redraw()},enable:function(){if(a.stateBeforeDisable){a.setState(a.stateBeforeDisable);a.stateBeforeDisable=null}else{if(a.state.name=="publicDisabled"){a.setState("public")}else{if(a.state.name=="privateDisabled"){a.setState("private")}}}a.redraw()},currentState:function(){if(a.state.name.search("public")!=-1){return"public"}else{return"private"}},setState:function(b){a.state=$(".status input[name="+b+"]",a).get(0)},submit:function(){var c="private";if(a.state.name=="public"){c="public"}var b={asin:a.asin,privacy:c};$.ajax({type:"post",url:a.url,beforeSend:function(d){d.setRequestHeader("Accept","text/javascript")},dataType:"json",data:b,success:function(d){a.stateBeforeSave=null},error:function(d){a.setState(a.stateBeforeSave);a.redraw()}})},redraw:function(){$("input",a).each(function(){$(this).hide()});if(a.state!==null){$(a.state).show()}}});this.init()})};
/* Copyright Amazon.com 2011 */
$.fn.dropBookWidget=function(){function a(c){if(!$(c).attr("class").match(/Active\b/)){$(c).attr("class",$(c).attr("class").replace(c.name,c.name+"Active"))}}function b(c){$(c).attr("class",$(c).attr("class").replace(c.name+"Active",c.name))}return this.each(function(){var c=this;$.extend(this,{state:null,stateBeforeSave:null,undoData:{},kindleOnly:$("input[name=kindle_only]",c).attr("value"),init:function(){c.state="in_list";$("input",c).removeAttr("disabled").hover(function(){a(this)},c.redraw).click(c.dropClick);$(".undoDrop",c).click(c.undoClick);c.redraw()},disableRelatedWidgets:function(){c.bookStatusWidget.disable();if(c.publicNotesWidget!==undefined){c.publicNotesWidget.disable("privateDisabled")}c.publicBookWidget.disable("privateDisabled")},dropClick:function(){$(this).blur();if($(this).hasClass("drop")||$(this).hasClass("dropActive")){c.stateBeforeSave=c.state;c.state="dropped";c.undoData={status:c.bookStatusWidget.currentState(),book_privacy:c.publicBookWidget.currentState()};if(c.publicNotesWidget!==undefined){c.undoData.notes_privacy=c.publicNotesWidget.currentState()}c.disableRelatedWidgets()}c.submit();c.redraw();return false},restoreRelatedWidgets:function(){c.bookStatusWidget.enable();if(c.publicNotesWidget!==undefined){c.publicNotesWidget.enable()}if(c.publicBookWidget!==undefined){c.publicBookWidget.enable()}},undoClick:function(){$(this).blur();if($(this).hasClass("undoDrop")){c.stateBeforeSave=c.state;c.state="in_list";c.restoreRelatedWidgets()}c.submit();c.redraw();return false},submit:function(){var d={fetch_counts:true,asin:c.asin,kindle_only:c.kindleOnly};if(c.state=="dropped"){d.drop=true}else{d.undoDrop=true;d.status=c.undoData.status;d.book_privacy=c.undoData.book_privacy;if(c.undoData.notes_privacy!==undefined){d.notes_privacy=c.undoData.notes_privacy}}$.ajax({type:"post",url:c.url,beforeSend:function(e){e.setRequestHeader("Accept","text/javascript")},dataType:"json",data:d,success:function(e){if(e.counts){for(i=1;i<=e.counts.length;i++){$("#readingListCount"+i).text(e.counts[i])}$("#readingListCountTotal").text(e.sum);$("#readingListCountUndecided").text(e.undecided)}c.stateBeforeSave=null;c.redraw()},error:function(e){c.state=c.stateBeforeSave;if(c.state=="dropped"){c.disableRelatedWidgets()}else{c.restoreRelatedWidgets()}c.redraw()}})},redraw:function(){$("input",c).each(function(){b(this)});$(".status .undoDrop",c).hide();if(c.state=="dropped"){a($(".status input[name=drop]",c).get(0));$(".status .undoDrop",c).show()}}});this.init()})};
/* Copyright Amazon.com 2010 */
var usedAsins=[];var upcomingAsins=[];var currentOffset=0;var readyForNextBook=true;function addNextBook(){readyForNextBook=false;var a={"used_asins[]":usedAsins,current_offset:currentOffset};if(upcomingAsins.length>0){a["upcoming_asins[]"]=upcomingAsins}$.ajax({url:"/your_highlights/next_book",data:a,success:function(e){if(e.length==0){$("#stillLoadingBooks").remove()}else{$("#allHighlightedBooks").append(e);var d=e.indexOf('id="',0)+4;var b=e.indexOf('"',d);var c=$("#"+e.substring(d,b));recordLatestState(c);if(nearPageBottom()){addNextBook()}else{readyForNextBook=true}}}})}function recordLatestState(b){var a=b.attr("id");var c=a.split("_")[0];var d=parseInt(a.split("_")[1]);usedAsins.push(c);currentOffset=d;if(b.find(".skipped").size()==1){usedAsins.push(b.find(".skipped").text())}upcomingAsins=b.find(".upcoming").text().split(",")}function nearPageBottom(){return $(window).scrollTop()>=$(document).height()-($(window).height()*2)}$(document).ready(function(){$("#nextBookLink").addClass("hidden");$("#stillLoadingBooks").removeClass("hidden");if($("#allHighlightedBooks").size()==1){window.scrollTo(0,0);$("#allHighlightedBooks").find(".yourHighlightsHeader").each(function(b,a){recordLatestState($(a))});if(nearPageBottom()){addNextBook()}}$(window).scroll(function(){if($("#allHighlightedBooks").size()==1){if(nearPageBottom()&&readyForNextBook){addNextBook()}}})});
$(document).ready(function(){$("form.preferencesForm").livequery(function(){var a=this;$(a).find(".preference").each(function(){var b=this;function c(g,h){data={};var d=$(b).find("input[name^='"+g+"Check']").get(0);var f=$(b).find("input[name^='"+g+"Uncheck']").get(0);var e=$(b).find("#"+g+"Label").get(0);if(h){data[f.name]=true}else{data[d.name]=true}$.ajax({type:"post",url:a.action,dataType:"json",data:data,beforeSend:function(i){i.setRequestHeader("Accept","text/javascript");if(h){$(f).hide();$(d).show();$(e).attr("for",d.name)}else{$(d).hide();$(f).show();$(e).attr("for",f.name)}}})}$(b).find("input[name$='Check']").click(function(){c(this.name.substr(0,this.name.length-5),false);return false});$(b).find("input[name$='Uncheck']").click(function(){c(this.name.substr(0,this.name.length-7),true);return false})})});$("#homeWrapper form.selectPreferredForm").livequery(function(){var b=this;var d=$(b).find("select[name=preferredDevice]").val();function c(){$(b).find(".savePreferredDevice").attr("disabled","disabled").addClass("savePreferredInactive")}function a(){$(b).find(".savePreferredDevice").removeAttr("disabled").removeClass("savePreferredInactive")}$(this).ajaxForm({type:"post",beforeSend:function(f,e){f.setRequestHeader("Accept","text/javascript");c()},success:function(e){a();d=$(b).find("select[name=preferredDevice]").val()},error:function(){a();$(b).find("select[name=preferredDevice]").val(d)}})});$("#homeWrapper form.networkDeregister").livequery(function(){var a=$(this).parents(".network");$(this).ajaxForm({type:"post",beforeSend:function(c,b){c.setRequestHeader("Accept","text/javascript");a.find(".errorNotification ").fadeOut("fast");a.find(".errorMessage").fadeOut("fast");a.find(".username").fadeOut("fast");a.find(".forms").fadeOut("fast",function(){a.find(".credentials input").attr("value","");a.find(".credentials").show();a.find(".link").show();a.find(".unlink").hide();a.find(".fix").hide();a.find(".networkSettingsUpdate").hide();a.find(".forms").fadeIn("fast")})}})});$("#homeWrapper form.networkSettingsUpdate input.auto_post").livequery("click",function(){var a=$(this).parents(".networkSettingsUpdate");$.ajax({type:"post",url:a.attr("action"),data:a.serialize(),beforeSend:function(c,b){c.setRequestHeader("Accept","text/javascript");a.find(".autoPostSaving").show();a.find(".autoPostSaved").hide();a.find(".autoPostError").hide()},success:function(b){a.find(".autoPostSaving").hide();a.find(".autoPostSaved").show()},error:function(){a.find(".autoPostSaving").hide();a.find(".autoPostError").show()}})})});
(function(d){var a={"delete_rating.x":0,"star_1.x":1,"star_2.x":2,"star_3.x":3,"star_4.x":4,"star_5.x":5};function b(f,e){for(i=1;i<=5;i++){var g=f.find("[name=star_"+i+"]");if(i<=e){g.attr("src","https://images-na.ssl-images-amazon.com/images/G/01/reading/images/filled-star._V192212993_.gif")}else{g.attr("src","https://images-na.ssl-images-amazon.com/images/G/01/reading/images/empty-star._V192212993_.gif")}}}function c(e){d("#editionRelationWidget"+e.find("[name=asin]").val()).each(function(){this.markReadIfUnknown()})}d.fn.starRating=function(e){var f={saveInFade:100,saveOutFade:2000};var e=d.extend(f,e);return this.each(function(){var l=d(this);var k=l.find("[name=old_num_stars]").val();var h=l.find(".deleteRating");var j=l.find(".userRatingProgressText");var g=l.find("[name^=star_]");g.mouseover(function(){var m=d(this).attr("name");var n=m.substring(m.length-1);b(l,n)});g.mouseout(function(){b(l,k)});l.ajaxForm({type:"post",beforeSend:function(m){m.setRequestHeader("Accept","text/javascript")},beforeSubmit:function(n){var m=null;d.each(n,function(p,o){m=a[o.name];if(m!=null){return false}});k=m;b(l,m);j.stop();j.text("Saving");j.fadeTo(e.saveInFade,1);m==0?h.hide():h.show()},success:function(m){c(l);j.text("Saved");j.fadeTo(e.saveOutFade,0)},failure:function(){ratingText.text("Failed to save")},resetForm:true})})}})(jQuery);
(function(a){a.fn.reliableTooltip=function(b){var c={showOnHover:true,literalContent:"",hoverShowDelay:500,title:null,skin:null,location:"right",locationMargin:0,width:null};var b=a.extend(c,b);return this.each(function(){var d=b;var e=a(this);d.literalContent='<p class="reliableTooltipText">'+this.title+"</p>";this.title="";e.amazonPopoverTrigger(d)})}})(jQuery);
(function(a){a.fn.authorResponse=function(b){var c={};var b=a.extend(c,b);return this.each(function(){var e=b;var d=this;var f=a(this);a.extend(this,{latestSavedText:null,editView:a(d).find(".editNote"),viewView:a(d).find(".viewNote"),textArea:a(d).find(".editNote").find(".authorNoteArea"),clearEditMessages:function(){d.editView.find(".saveErrorMessage").hide();d.editView.find(".deleteSuccessMessage").hide()},showSaveError:function(){d.editView.find(".saveErrorMessage").show()},showDeleteSuccess:function(){d.editView.find(".deleteSuccessMessage").show()},resetEditForm:function(){d.latestSavedText=d.textArea.val();var g=d.editView.find(".postResponseButton");g.addClass("postResponseButtonInactive");g.attr("disabled",true);d.textArea.bind("keyup",function(){if(d.textArea.val()!=d.latestSavedText){d.textArea.unbind();g.removeClass("postResponseButtonInactive");g.attr("disabled",false)}})},startEditing:function(){d.textArea.val(d.viewView.find(".noteContent").text());d.editView.removeClass("hidden");d.viewView.addClass("hidden");return false},finishEditing:function(){d.viewView.find(".noteContent").text(d.textArea.val());d.editView.addClass("hidden");d.viewView.removeClass("hidden")},updateTimestamp:function(g){d.viewView.find(".sharedOn").text(g)}});d.resetEditForm();a(d).find(".editResponseButton").click(d.startEditing);a(d).find(".editForm").ajaxForm({dataType:"json",beforeSend:function(g){d.clearEditMessages();if(d.textArea.val().length>0){d.finishEditing()}g.setRequestHeader("Accept","text/javascript")},success:function(g){d.resetEditForm();d.updateTimestamp(g.timestamp);if(d.textArea.val().length==0){d.showDeleteSuccess()}},error:function(g,i,h){d.startEditing();d.showSaveError()},resetForm:false})})}})(jQuery);
(function(a){a.fn.share=function(b){var c={successFunction:null};var b=a.extend(c,b);return this.each(function(){var e=b;var d=this;var f=a(this);a.extend(this,{disableAllInputs:function(){a(".shareSending",f).show();a("a.shareCancelButton",f).addClass("shareCancelButtonDisabled");a("input[name=shareButton]",f).addClass("shareButtonDisabled");a("textarea, input",f).attr("disabled","disabled")},enableAllInputs:function(){a(".shareSending",f).hide();a("a.shareCancelButton",f).removeClass("shareCancelButtonDisabled");a("input[name=shareButton]",f).removeClass("shareButtonDisabled");a("textarea, input",f).attr("disabled",null)},hideError:function(){a(".error",f).hide()},showError:function(g){a(".error").html(g).show()}});f.ajaxForm({type:"post",dataType:"json",beforeSend:function(g){g.setRequestHeader("Accept","text/javascript");d.disableAllInputs();d.hideError()},success:function(g){if(e.successFunction){e.successFunction(g)}if(g.error){d.showError(g.error);d.enableAllInputs()}else{a(".ap_custom_close",f[0]).click()}},error:function(g,i,h){d.showError("Something went wrong, please try again");d.enableAllInputs()}});f.find(".shareArea").focus()})}})(jQuery);
(function(a){a.fn.tabbedContent=function(){return this.each(function(){var b=this;var d=a(this);var c=function(){return a("li",d)};c().tab({tabbedContent:b});a.extend(this,{showSelectedTab:function(){for(var e=0;e<c().length;e++){c()[e].setTabVisibility()}},deselectAll:function(){for(var e=0;e<c().length;e++){c()[e].setSelected(false)}}});b.showSelectedTab()})}})(jQuery);(function(a){a.fn.tab=function(b){return this.each(function(){var d=b;var c=this;var e=a(this);a.extend(this,{contentTabClass:"."+a("a",e)[0].rel,contentTab:function(){return a(d.tabbedContent).siblings(c.contentTabClass)},setTabVisibility:function(){if(e.hasClass("tabSelected")){c.contentTab().show()}else{c.contentTab().hide()}},setSelected:function(f){if(f){e.addClass("tabSelected")}else{e.removeClass("tabSelected")}}});a("a",e).livequery("click",function(){d.tabbedContent.deselectAll();c.setSelected(true);d.tabbedContent.showSelectedTab();return false})})}})(jQuery);
(function(a){a.fn.countdownText=function(){return this.each(function(){var b=this;var d=a(this);var e=a(".shareRemaining .number",d);var c=a(".shareRemaining .minimum",d);a.extend(this,{textArea:a(".shareArea",d),remainingNumber:e,shareButton:a(".shareButton",d),minChars:parseInt(c.text()),maxChars:parseInt(e.text()),updateRemaining:function(f){var g=b.textArea[0].value.length;var h=b.maxChars-g;b.remainingNumber.text(h);if(g<b.minChars){b.shareButton.addClass("shareButtonDisabled");b.shareButton.attr("disabled","disabled");b.remainingNumber.parent().removeClass("overflow")}else{if(h>=0){b.remainingNumber.parent().removeClass("overflow");b.shareButton.removeClass("shareButtonDisabled");b.shareButton.attr("disabled","")}else{b.remainingNumber.parent().addClass("overflow");b.shareButton.addClass("shareButtonDisabled");b.shareButton.attr("disabled","disabled")}}}});b.textArea.livequery("keyup",function(){b.updateRemaining("keyup")});b.updateRemaining()})}})(jQuery);